/*! viral-50 v0.0.1 | (c) 2020 Erik BÃ¥venstrand | MIT License | https://github.com/ErikBavenstrand/DH2321-Spotify-Project */
var tooltipZoom,tooltipCC,world=d3.select("#world").append("svg"),g=world.append("g"),worldWidth=parseInt(d3.select(".Root__main-view").style("width")),worldHeight=parseInt(d3.select(".Root__main-view").style("height")),countryTooltip=d3.select("#world").append("div").attr("class","country-tooltip"),tooltipRecent=!1,worldProjection=d3.geoMercator().rotate([-12,0,0]).center([0,0]).scale(worldHeight/1.17/Math.PI).translate([worldWidth/2,worldHeight/1.7]),worldGraticule=d3.geoGraticule(),worldPath=d3.geoPath().projection(worldProjection),zoom=d3.zoom().scaleExtent([1,7]).on("zoom",(function(){var t=d3.event.transform,e=worldWidth*(1-t.k),o=worldHeight*(1-t.k);t.x=Math.min(0,Math.max(e,t.x)),t.y=Math.min(0,Math.max(o,t.y)),g.selectAll("path").attr("transform",t)}));function generateWorldMap(t){g.selectAll("path").data(t.features,(function(t){return t})).enter().append("path").attr("d",worldPath).classed("defaultCountry",!0).each((function(t,e){d3.select(this).classed(t.id,!0)})).on("mouseover",(function(t,e){d3.select(this).classed("countryIsInCurrentData")&&(highlightCountryInList(t.id,!0),highlightCountryOnMap(t.id,!0))})).on("click",(function(t,e){d3.select(this).classed("countryIsInCurrentData")&&(countryClickSelection(t.id),handleCountryClickShowDetail(t.id))})).on("mouseout",(function(t,e){d3.select(this).classed("countryIsInCurrentData")}))}function existsOnMap(t){return null!==d3.select("."+t)._groups[0][0]}function updateWorldMap(t,e,o){var r=Object.keys(t);d3.selectAll(".defaultCountry").classed("countryIsInCurrentData",!1).style("fill",null).filter((function(t){return r.indexOf(t.id)>-1||r.indexOf(t)>-1})).classed("countryIsInCurrentData",!0).each((function(r){var n;n=r.id?r.id:r,d3.select(this).style("fill",calculateColorFromValue(t[n][currentAttribute],e[currentAttribute],o[currentAttribute],minColor,maxColor))})),updateLegend(t,e,o)}function handleCountryClickShowDetail(t){zoomInCountry(t),isInDetailView=!0}function highlightCountryOnMap(t,e){existsOnMap(t)&&(e?(d3.select(".countryHoveredTrigger").each((function(t,e){highlightCountryOnMap(t,!1),highlightCountryInList(t,!1)})),g.append("path").data([t]).attr("d",d3.select("."+t).attr("d")).classed("defaultCountry",!0).classed("countryHighlight",!0).classed("countryHoveredTrigger",!0).classed(t,!0).attr("id",t+"-highlit").attr("transform",d3.select("."+t).attr("transform")).on("click",(function(t,e){countryClickSelection(t),handleCountryClickShowDetail(t)})).on("mouseout",(function(t,e){highlightCountryOnMap(t,!1),highlightCountryInList(t,!1)})),d3.select("#"+t+"-highlit").style("fill",calculateColorFromValue(data_attrs[dataWeek][t][currentAttribute],data_attrs.minimum[currentAttribute],data_attrs.maximum[currentAttribute],minColor,maxColor))):d3.select("#"+t+"-highlit").remove())}function zoomInCountry(t){toggleDetailViewVisibility();var e=worldProjection(worldCountryZoomJSON[t]),o=e[0],r=e[1];d3.event.stopPropagation(),world.transition().duration(1500).call(zoom.transform,d3.zoomIdentity.translate(worldWidth/2,worldHeight/2).scale(1e3).translate(-o,-r))}function zoomOutCountryHideDetail(t){isInDetailView=!1,setTimeout(clearSelectedSongs,2e3),toggleDetailViewVisibility(),d3.event.stopPropagation();var e=worldProjection(worldCountryZoomJSON[t]),o=e[0],r=e[1];world.transition().duration(1).call(zoom.transform,d3.zoomIdentity.translate(worldWidth/2,worldHeight/2).scale(8).translate(-o,-r)).transition().duration(1500).call(zoom.transform,d3.zoomIdentity.scale(1))}world.call(zoom);